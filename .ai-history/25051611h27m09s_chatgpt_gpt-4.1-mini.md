# Make the application display an error message if a required environment variable is not set 

I want to implement the feature that if an environment variable required by the backend is not set, the application should display an error message in a red box at the top of the home page.

Tell me the modifications to make to the code in order to achieve that.



# This is gpt-4.1-mini answer (5k in, 1k out)

To display an error message on the home page if a required environment variable is missing, you need to:

1. Detect missing environment variables on server start or on each request.
2. Pass an error message to the EJS template.
3. Modify the EJS template to display the error message in a red box at the top.

---

### Step 1: Modify `./src/index.ts`

Add a function to check required environment variables (`OPENAI_API_KEY`, `GEMINI_API_KEY`, `AUTH_TOKEN`). Then, pass an error message to the template if any are missing.

Modify your `index.ts` as follows:

```ts
// Add this helper function near the top of the file (after imports)
function checkRequiredEnvVars(): string | null {
  const missingVars: string[] = [];
  if (!process.env.OPENAI_API_KEY) missingVars.push("OPENAI_API_KEY");
  if (!process.env.GEMINI_API_KEY) missingVars.push("GEMINI_API_KEY");
  if (!process.env.AUTH_TOKEN) missingVars.push("AUTH_TOKEN");

  if (missingVars.length > 0) {
    return `Error: Missing required environment variable(s): ${missingVars.join(", ")}`;
  }
  return null;
}

app.get('/', (req: Request, res: Response) => {
  const envError = checkRequiredEnvVars();
  res.render('index', {
    geminiCVResult: "Waiting for your job description for CV generation",
    openAICVResult: "Waiting for your job description for CV generation",
    geminiCoverLetterResult: "Waiting for your question for Cover Letter",
    openAICoverLetterResult: "Waiting for your question for Cover Letter",
    envError // pass error message or null
  });
});

app.post('/', async (req: Request, res: Response) => {
  const envError = checkRequiredEnvVars();
  if (envError) {
    return res.render('index', {
      geminiCVResult: "",
      openAICVResult: "",
      geminiCoverLetterResult: "",
      openAICoverLetterResult: "",
      envError
    });
  }

  // ... existing code unchanged, but add envError to render calls

  const { company, job, language, position, words, token } = req.body;
  const searchCompanyInfo = req.body.searchCompany === 'true';

  if (!company || !job || !language || !position || !words || !token) {
    return res.render('index', {
      geminiCVResult: "Missing required fields for CV",
      openAICVResult: "Missing required fields for CV",
      geminiCoverLetterResult: "Missing required fields for Cover Letter",
      openAICoverLetterResult: "Missing required fields for Cover Letter",
      envError: null
    });
  }

  if (token !== getAuthToken()) {
    return res.render('index', {
      geminiCVResult: "Invalid token",
      openAICVResult: "Invalid token",
      geminiCoverLetterResult: "Invalid token",
      openAICoverLetterResult: "Invalid token",
      envError: null
    });
  }

  try {
    const geminiCV = await getGeminiCVResult(job, position, language);
    const openAICV = await getOpenAICVResult(job, position, language);
    const geminiCoverLetter = await getGeminiCoverLetterResult(company, position, job, language, words, searchCompanyInfo);
    const openAICoverLetter = await getOpenAICoverLetterResult(company, position, job, language, words, searchCompanyInfo);

    res.render('index', {
      geminiCVResult: geminiCV,
      openAICVResult: openAICV,
      geminiCoverLetterResult: geminiCoverLetter,
      openAICoverLetterResult: openAICoverLetter,
      envError: null
    });
  } catch (error) {
    console.error("Error processing request:", error);
    res.status(500).render('index', {
      geminiCVResult: "An error occurred during CV generation",
      openAICVResult: "An error occurred during CV generation",
      geminiCoverLetterResult: "An error occurred during Cover Letter generation",
      openAICoverLetterResult: "An error occurred during Cover Letter generation",
      envError: null
    });
  }
});
```

---

### Step 2: Modify `./views/index.ejs`

Add a block at the top inside the `<body>` to display the error message if `envError` is set. Use a Bootstrap alert with `alert-danger` class for a red box.

Add this snippet right after `<body>` tag:

```html
<body>
  <div class="container mt-3">
    <% if (envError) { %>
      <div class="alert alert-danger" role="alert">
        <%= envError %>
      </div>
    <% } %>
  </div>
  
  <!-- existing content -->
```

You can keep the rest of your existing content inside the container or adjust the container div accordingly.

---

### Summary

- Added `checkRequiredEnvVars()` in `index.ts` to detect missing env vars.
- Pass `envError` string or null to the template.
- Display `envError` in a red Bootstrap alert box at the top of the page.

This will show a clear error message if any required environment variable is missing, helping users or developers quickly identify configuration issues.

