# "Missing required fields for CV" and "Missing required fields for Cover Letter" when "Attempt to use specific information about the company" is unchecked

When the user unchecks the "Attempt to use specific information about the company" checkbox, 
then submit the form, the application displays a message saying "Missing required fields for CV" 
and "Missing required fields for Cover Letter".

This is not the expected behavior.

The expected behavior is that the application should process the form and generate the CV and Cover Letter without paying attention to the target enterprise.

It must only care about the enterprise name when the user checks the "Attempt to use specific information about the company" checkbox.

Tell me the modifications to make to the code in order to achieve that.



# This is gpt-4.1-mini answer (5k in, 1k out)

The issue comes from the fact that when the checkbox "Attempt to use specific information about the company" is unchecked, your client-side script disables the company input and sets its value to `'Unknown'`. However, in your server-side code (`./src/index.ts`), you require `company` to be present and non-empty for processing, and the form submission sends `'Unknown'` as the company value, which is considered a valid string, so it should not trigger the "Missing required fields" error.

But your current validation logic:

```ts
if (!company || !job || !language || !position || !words || submittedToken === undefined) {
  // ...
}
```

considers `'Unknown'` as a valid `company` value, so it should not cause the missing fields error.

**However, the problem is likely that when the checkbox is unchecked, the `company` input is disabled, and some browsers do not send disabled inputs in the form submission at all.** So the `company` field is missing from `req.body`, making `company` undefined or empty on the server side, triggering the missing fields error.

---

### How to fix this:

**Option 1: Change the client-side code to not disable the company input, but instead set its value to `'Unknown'` and make it readonly or visually disabled.**

This way, the `company` field is always submitted.

Modify the script in `index.ejs`:

Replace this part:

```js
if (searchCompanyCheckbox.checked) {
  companyInput.disabled = false;
  companyInput.placeholder = "Enter company name (required for company-specific info)";
  companyLabel.textContent = "Company name (required for search)";
  if (companyInput.value === 'Unknown') {
    companyInput.value = '';
  }
} else {
  companyInput.disabled = true;
  companyInput.placeholder = "Company information will not be used";
  companyLabel.textContent = "Company name (will not be used)";
  companyInput.value = 'Unknown';
}
```

with:

```js
if (searchCompanyCheckbox.checked) {
  companyInput.readOnly = false;
  companyInput.placeholder = "Enter company name (required for company-specific info)";
  companyLabel.textContent = "Company name (required for search)";
  if (companyInput.value === 'Unknown') {
    companyInput.value = '';
  }
} else {
  companyInput.readOnly = true;
  companyInput.placeholder = "Company information will not be used";
  companyLabel.textContent = "Company name (will not be used)";
  companyInput.value = 'Unknown';
}
```

**Explanation:**  
Using `readOnly` instead of `disabled` keeps the input enabled for form submission but prevents user editing.

---

### Option 2: Modify server-side code to accept missing `company` field when `searchCompany` is false

In your `POST /` handler in `index.ts`, change the validation to:

```ts
if (!job || !language || !position || !words || submittedToken === undefined) {
  return res.render('index', {
    ...baseRenderOptions,
    geminiCVResult: "Missing required fields for CV",
    openAICVResult: "Missing required fields for CV",
    geminiCoverLetterResult: "Missing required fields for Cover Letter",
    openAICoverLetterResult: "Missing required fields for Cover Letter"
  });
}

// If searchCompanyInfo is true, company is required
if (searchCompanyInfo && (!company || company.trim() === '')) {
  return res.render('index', {
    ...baseRenderOptions,
    geminiCVResult: "Missing company name for company-specific info",
    openAICVResult: "Missing company name for company-specific info",
    geminiCoverLetterResult: "Missing company name for company-specific info",
    openAICoverLetterResult: "Missing company name for company-specific info"
  });
}

// If searchCompanyInfo is false, set company to 'Unknown' if missing
const effectiveCompany = searchCompanyInfo ? company : 'Unknown';
```

Then, use `effectiveCompany` instead of `company` in the calls to the generation functions:

```ts
const geminiCoverLetter = await getGeminiCoverLetterResult(effectiveCompany, position, job, language, words, searchCompanyInfo);
const openAICoverLetter = await getOpenAICoverLetterResult(effectiveCompany, position, job, language, words, searchCompanyInfo);
```

---

### Summary of changes

1. **Client-side:** Replace `companyInput.disabled = true/false` with `companyInput.readOnly = true/false` in `index.ejs` script.

2. **Server-side:**  
   - Change validation to require `company` only if `searchCompanyInfo` is true.  
   - Use `'Unknown'` as company when `searchCompanyInfo` is false.

---

If you want, I can provide the exact updated code snippets for both client and server sides.

